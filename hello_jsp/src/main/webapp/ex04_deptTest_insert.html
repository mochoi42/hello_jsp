<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript" src="jquery-3.7.1.min.js"></script>
<script>
	$(function(){
		let loadDept = function(){
			$.ajax({
				url : "listDept_json2.jsp",
			    success:function(data){
			    	//노드 깔끔하게 삭제하기
			    	$("#output").empty();
			    	//data --> 배열
			    	let table = $("<table></table>");
			    	$.each(data, function(i, dept){
			    		//이 안에서 this를 쓰면 여기서 반복문의 요소 하나하나를 받을 수 있다.
			    		//console.log(this.dname);	
			    		//console.log(dept.dname);
			    		
			    		let tr = $("<tr></tr>");
		    			let td1 = $("<td></td>").html(dept.dno);
		    			let td2 = $("<td></td>").html(dept.dname);
		    			let td3 = $("<td></td>").html(dept.dloc);
		    			$(tr).append(td1, td2, td3);
		    			$(table).append(tr);
			    	});
			    	$("#output").append(table);
			    }
			});
		}
		//my_form 의 submit 이 눌러지면 아래 실행
		$("#my_form").submit(function(e){
			let dno = $("#dno").val();
			let dname = $("#dname").val();
			let dloc = $("#dloc").val();
			
			//속성명 : 속성값(아래는 변수)
			let item = {dno:dno, dname:dname, dloc:dloc};
			
			$.ajax({
				url: "insertDept.jsp",
				data:item,
				success:function(r){
					if(r.msg == "1"){
						loadDept();
					}
				}
			});

			//기본 이벤트 제거
			e.preventDefault();
		});
		//btnRead이 눌리면 실행
		$("#btnRead").click(function(){
			loadDept();
		});
	})
</script>
<style>
    table{
        border:1px solid #ddd;
        border-spacing: 0;
        border-collapse: collapse;
    }
    table td{
        border:1px solid #ddd;
    }
</style>
</head>
<body>
    <textarea name="" id=""></textarea>
    <hr>
    <h1>Hello Kosta</h1>
    <button id="btnRead">부서목록 읽어오기</button>
    <hr>
    <div id="output"></div>
	<hr>
    <form id="my_form" action="#">
		<table>
			<tr>
				<td>부서번호</td>
				<td><input type="text" id="dno"></td>
			</tr>
			<tr>
				<td>부서명</td>
				<td><input type="text" id="dname"></td>
			</tr>
			<tr>
				<td>부서위치</td>
				<td><input type="text" id="dloc"></td>
			</tr>
			<tr>
				<td colspan="2">
					<input type="reset" value="재입력">
					<input type="submit" value="등록">
				</td>
			</tr>
		</table>
	</form>
</body>
</html>